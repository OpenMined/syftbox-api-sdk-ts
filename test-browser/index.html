<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyftBox API SDK - Test Interface</title>
    
    <!-- Clean minimalist styles -->
    <link rel="stylesheet" href="assets/css/clean.css">
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <h1>SyftBox API SDK</h1>
            <p>Test interface for authentication, file operations, and datasite services</p>
        </header>

        <!-- Authentication Card -->
        <div class="card">
            <h2>üîê Authentication</h2>
            <p>Connect to your SyftBox account using OTP authentication</p>
            

            <div class="form-section">
                <h3>Request Access Code</h3>
                <div class="form-group">
                    <input type="email" id="email" placeholder="your-email@example.com" />
                    <button disabled id="otp-request-btn" class="btn btn-primary">Send Code</button>
                </div>
                <div id="otp-request-status"></div>
            </div>

            <div class="form-section">
                <h3>Verify & Login</h3>
                <div class="form-group">
                    <input type="text" id="otp" placeholder="Enter 8-digit code" maxlength="8" />
                    <button disabled id="otp-verify-btn" class="btn btn-primary">Login</button>
                </div>
                <div id="auth-status"></div>
            </div>
        </div>

        <!-- File Operations Card -->
        <div class="card">
            <h2>üìÅ File Operations</h2>
            <p>Test file upload and download functionality with your authenticated account</p>
            
            <div class="form-section">
                <h3>Upload Test</h3>
                <div class="form-group">
                    <button disabled id="test-btn" class="btn btn-primary">Upload Test File</button>
                </div>
                <div id="upload-status"></div>
            </div>

            <div class="form-section">
                <h3>Download Test</h3>
                <div class="form-group">
                    <button disabled id="download-test-btn" class="btn btn-secondary">Download Test File</button>
                </div>
                <div id="download-test-status"></div>
            </div>
        </div>

        <!-- Datasite Services Card -->
        <div class="card">
            <h2>üóÑÔ∏è Datasite Services</h2>
            <p>Explore your files and test datasite caching functionality</p>
            
            <div class="form-section">
                <h3>View All Files</h3>
                <div class="form-group">
                    <button disabled id="datasite-btn" class="btn btn-primary">Load File View</button>
                </div>
                <div id="services-status"></div>
            </div>

            <div class="form-section">
                <h3>Filter by Path</h3>
                <div class="form-group">
                    <input type="text" id="path-input" placeholder="Enter path prefix (e.g., public/, data/)" value="public/" />
                    <button disabled id="path-view-btn" class="btn btn-secondary">Filter Files</button>
                </div>
                <div id="path-view-status"></div>
                
                <!-- File paths display container -->
                <div id="file-paths-container" class="files-container" style="display: none;">
                    <div class="files-header">
                        <h3 id="files-title">Filtered Files</h3>
                    </div>
                    <div id="file-paths-list" class="files-list"></div>
                    <div id="file-summary" class="files-summary"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- SyftBox Client Library (UMD Bundle) -->
    <script src="../dist/syftbox.umd.js"></script>
    
    <!-- Testing Application Module -->
    <script src="assets/js/testing-app.js"></script>

    <script>
        // Initialize testing application when page loads
        let testingApp;
        
        window.addEventListener('load', () => {
            console.log('üîç Checking SyftBoxClient availability...');
            
            if (typeof SyftBoxClient !== 'undefined') {
                console.log('‚úÖ SyftBoxClient loaded successfully');
                console.log('Available exports:', Object.keys(SyftBoxClient));
                
                testingApp = new TestingApp();
                
                // Expose app to global scope for debugging
                window.testingApp = testingApp;
                
                if (new URLSearchParams(window.location.search).get('debug') === 'true') {
                    window.SyftBox = SyftBoxClient;
                    console.log('üîß Debug mode: SyftBoxClient exposed as window.SyftBox');
                    console.log('üîß Testing app exposed as window.testingApp');
                }
            } else {
                console.error('‚ùå SyftBoxClient not found! Check if the bundle loaded correctly.');
                alert('‚ùå Failed to load SyftBox SDK bundle!');
            }
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (testingApp && document.hidden) {
                console.log('‚è∏Ô∏è Testing paused (page hidden)');
            } else if (testingApp && !document.hidden) {
                console.log('‚ñ∂Ô∏è Testing resumed (page visible)');
            }
        });
    </script>
</body>
</html>